var author = "eyJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjoie1wiY29ublR5cGVcIjoyLFwic3lzVHlwZVwiOjEsXCJ1c2VySWRcIjoxLFwidXNlck5hbWVcIjpcImFkbWluXCIsXCJlbXBsb3llZU5vXCI6XCIyMDE2MTIwMjAyXCIsXCJuYW1lXCI6bnVsbCxcIm5pY2tOYW1lXCI6XCJcIixcInBsYXRmb3JtXCI6bnVsbCxcInBob25lTnVtYmVyXCI6bnVsbCxcImNvbXBhbnlJZFwiOjEsXCJjb21wYW55TmFtZVwiOlwi5pit6ZizXCIsXCJsb2dvXCI6XCJodHRwOi8vZXNoaXBwaW5nLWZpbGVzdG9yZS5vc3MtY24taGFuZ3pob3UuYWxpeXVuY3MuY29tL3VwbG9hZC83NWU5OTlhMTYyMWE0ZjIzYTIzMmJjYmVlYjlhM2JmZi5wbmdcIixcImN1c3RvbWVySWRcIjpudWxsLFwiZGVwdElkXCI6bnVsbCxcInVzZXJMZXZlbFwiOjAsXCJ1c2VyVHlwZVwiOjAsXCJmY2xMZXZlbElkXCI6bnVsbCxcInJvbGVJZHNcIjpudWxsLFwicGVybWlzc2lvbnNcIjpbXCJBTEQtMDEwMTAxXCIsXCJBTEQtMDcwMlwiLFwiQUxELTA0MDIwN1wiLFwiQUxELTAxMDEwMlwiLFwiQUxELTA3MDFcIixcIkFMRC0wNDAyMDZcIixcIkFMRC0wMTAxMDNcIixcIkFMRC0wNzA0XCIsXCJBTEQtMDEwMTA0XCIsXCJBTEQtMDQwMjA5XCIsXCJBTEQtMDcwM1wiLFwiQUxELTA0MDIwOFwiLFwiQUxELTAxMDEwNVwiLFwiQUxELTAxMDEwNlwiLFwiQUxELTAxMDEwN1wiLFwiQUxELTAxMDEwOFwiLFwiQUxELTAxMDEwOVwiLFwiQUxELTA1MDcwM1wiLFwiQUxELTA1MDNcIixcIkFMRC0wNTA3MDJcIixcIkFMRC0wNTA0XCIsXCJBTEQtMDUwNzAxXCIsXCJBTEQtMDUwNVwiLFwiQUxELTA1MDcwNlwiLFwiQUxELTA1MDcwNVwiLFwiQUxELTA1MDcwNFwiLFwiQUxELTA1MDJcIixcIkFMRC0wNDA0XCIsXCJBTEQtMDQwMTA2XCIsXCJBTEQtMDQwMTA1XCIsXCJBTEQtMDQwMTA0XCIsXCJBTEQtMDQwMTAzXCIsXCJBTEQtQURNSU4tUExBVEZPUk1cIixcIkFMRC0wNDAxMDJcIixcIkFMRC0wNDAxMDFcIixcIkFMRC0wNzEwXCIsXCJBTEQtMDQwMjAxXCIsXCJBTEQtMDcwOVwiLFwiQUxELTA3MDdcIixcIkFMRC0wNDAyMDRcIixcIkFMRC0wNzA4XCIsXCJBTEQtMDQwMjA1XCIsXCJBTEQtMDcwNVwiLFwiQUxELTA0MDIwMlwiLFwiQUxELTA3MDZcIixcIkFMRC0wNDAyMDNcIixcIkFMRC0wNDAzMDNcIixcIkFMRC0wNDAzMDFcIixcIkFMRC0wNDAzMDJcIixcIkFMRC0wNTAxMDVcIixcIkFMRC0wNTAxMDRcIixcIkFMRC0wNTAxMDNcIixcIkFMRC0wNTAxMDJcIixcIkFMRC0wNTAxMDFcIixcIkFMRC0wMVwiLFwiQUxELTAzXCIsXCJBTEQtMDJcIixcIkFMRC0wNVwiLFwiQUxELTA0XCIsXCJBTEQtMDdcIixcIkFMRC0wMjAyMDJcIixcIkFMRC0wMTAzXCIsXCJBTEQtMDIwMjAxXCIsXCJBTEQtMDIwMjA0XCIsXCJBTEQtMDIwMzA1XCIsXCJBTEQtMDIwMzAzXCIsXCJBTEQtMDIwMzA0XCIsXCJBTEQtMDIwMzAxXCIsXCJBTEQtMDIwMzAyXCIsXCJBTEQtMDEwMjA0XCIsXCJBTEQtMDIwMTA3XCIsXCJBTEQtMDEwMjAzXCIsXCJBTEQtMDIwMTA2XCIsXCJBTEQtMDEwMjAyXCIsXCJBTEQtQURNSU5cIixcIkFMRC0wMjAxMDVcIixcIkFMRC0wMTAyMDFcIixcIkFMRC0wMjAxMDRcIixcIkFMRC0wMjAxMDNcIixcIkFMRC0wMjAxMDJcIixcIkFMRC0wMjAxMDFcIixcIkFMRC0wMzAxXCIsXCJBTEQtMDMwMlwiLFwiQUxELTAzMDNcIixcIkFMRC0wMzA0XCIsXCJBTEQtMDMwNVwiXSxcInVzZXJQb3J0TGlzdFwiOm51bGwsXCJ1c2VyUm91dGVMaXN0XCI6bnVsbCxcInVzZXJTaGlwcGluZ0xpc3RcIjpudWxsfSIsImV4cCI6MjUzMzcwNzM2MDAwfQ.mCq5iZza_aWBdsl84pEvymZFh4h_IlzlMlE8VNfgm8I";
var	sys_source="aladdin_website";

var $table = $('#table'),
    $remove = $('#remove'),
    selections = [];
var is = false;
function refreshTable() {
  /*  $('#table').bootstrapTable('removeAll'); 清空表格*/
    $("#table").bootstrapTable("refresh");
}

function initTable(){
	
	var columns = [
	               {
	                   field: '',
	                   checkbox: true,
	                   align: 'center'
	               },{
	                   field: 'id',
	                   title: 'id',
	                   sortable: true,
	                   align: 'center',
	                   valign: 'middle',
	                   formatter: function totalNameFormatter(value, row, index) {
	                   	 return "<img src=''>"+value;
	                   }
	               },{
	                   field: 'portStartId',
	                   title: 'portStartId',
	                   valign: 'middle',
	                   align: 'center',
	                   sortable : true
	               },{
	                   field: 'portStartName',
	                   title: 'portStartName',
	                   valign: 'middle',
	                   align: 'center',
	                   sortable : true
	               },{
	                   field: 'portEndName',
	                   title: 'portEndName',
	                   valign: 'middle',
	                   align: 'center',
	                   sortable : true
	               },{
	                   field: 'shippingName',
	                   title: 'shippingName',
	                   valign: 'middle',
	                   align: 'center',
	                   sortable : true
	               },{
	                   field: 'portEndId',
	                   title: 'portEndId',
	                   valign: 'middle',
	                   align: 'center',
	                   sortable : true,
	                   visible:false
	               }
	           ];
	
    $table.bootstrapTable({
        height: getHeight(),//定义表格的高度。
        method:"post",//请求方式
        striped: true,//设置为 true 会有隔行变色效果
        showColumns:true,//显示自定义列
        showRefresh:true,//显示刷新按钮
        dataType: "json",
        url : "http://localhost:8080/aladdin_services/freightaldweb/queryFreightAldWebList?Authorization="+author+"&sys_source="+sys_source,//请求地址
        columns: columns
        ,queryParams: function (params) {
        	var limit = params.limit; //页面大小
			var offset = params.offset; //页码
			var currentPage = offset/limit+1;
			var orderByName = null; //排序名称
			if( params.sort != undefined){
				orderByName = params.sort + " " +params.order
			}
			
			var entity = "";
			if (is) {
				limit = 10;
				offset = 0;
			}
			var temp = {
				pageSize : limit, //页面大小
				pageNo : currentPage, //页码
				orderColumn : orderByName //排序
//				data : entity,
//				Authorization : author,
//				sys_source : sys_source
			};
			/*var temp ="&pageSize="+pageSize+"&pageNo="+currentPage;*/
			return {pageNo:"1"},temp;
        },onLoadError: function (status) {
            //请求错误
            return false;
        },onLoadSuccess: function (data) {
        	 
        },onDblClickCell: function (data) {
			alert("双击添加事件");
		}
    });
}
    
    // sometimes footer render error.
    setTimeout(function () {
        $table.bootstrapTable('resetView');
    }, 200);
    $table.on('check.bs.table uncheck.bs.table ' +
        'check-all.bs.table uncheck-all.bs.table', function () {
        $remove.prop('disabled', !$table.bootstrapTable('getSelections').length);
        // save your data, here just save the current page
        selections = getIdSelections();
        // push or splice the selections if you want to save all data selections
    });
    $table.on('expand-row.bs.table', function (e, index, row, $detail) {
        if (index % 2 == 1) {
            $detail.html('Loading from ajax request...');
            $.get('LICENSE', function (res) {
                $detail.html(res.replace(/\n/g, '<br>'));
            });
        }
    });
    $table.on('all.bs.table', function (e, name, args) {
        console.log(name, args);
    });
    $remove.click(function () {
        var ids = getIdSelections();
        $table.bootstrapTable('remove', {
            field: 'id',
            values: ids
        });
        $remove.prop('disabled', true);
    });
    $(window).resize(function () {
        $table.bootstrapTable('resetView', {
            height: getHeight()
        });
    });
    
    
    
    var $table2 = $('#table1'), $remove2 = $('#remove1'), selections2 = [];
    function history() {
    	$("#table1").bootstrapTable("refresh");
    }
    
    function initTable2() {
    	$table2.bootstrapTable({
            height: getHeight(),//定义表格的高度。
            method:"get",//请求方式
            striped: true,//设置为 true 会有隔行变色效果
            showColumns:true,//显示自定义列
            showRefresh:true,//显示刷新按钮
            url : "json.json",//请求地址
            columns: [
                {
                    field: '',
                    checkbox: true,
                    align: 'center'
                },{
                    field: 'name',
                    title: '名字',
                    sortable: true,
                    align: 'center',
                    valign: 'middle',
                    formatter: function totalNameFormatter(data) {
                        return data;
                    }
                },{
                    field: 'sex',
                    title: '性别',
                    valign: 'middle',
                    align: 'center',
                    sortable : true
                },{
                    field: 'content',
                    title: '内容',
                    valign: 'middle',
                    align: 'center',
                    sortable : true,
                    visible:false
                }
            ],queryParams: function (params) {
            	var limit = params.limit; //页面大小
    			var offset = params.offset; //页码
    			var currentPage = offset/limit+1;
    			var orderByName = null; //排序名称
    			if( params.sort != undefined){
    				orderByName = params.sort + " " +params.order
    			}
    			var entity = "";
    				limit = 10;
    				offset = 0;
    			var temp = {
    				pageSize : limit, //页面大小
    				currentPage : currentPage, //页码
    				orderBy : orderByName, //排序
    				data : entity
    			};
    			return temp;
            },onLoadError: function (status) {
                //请求错误
                return false;
            },onLoadSuccess: function (data) {
            	//请求成功
            },onDblClickCell: function (data) {
    			alert("双击添加事件");
    		}
        });
    }
    
 // sometimes footer render error.
	setTimeout(function() {
		$table2.bootstrapTable('resetView');
	}, 200);
	$table2.on('check.bs.table uncheck.bs.table '
			+ 'check-all.bs.table uncheck-all.bs.table', function() {
		$remove2
				.prop('disabled',
						!$table2.bootstrapTable('getSelections').length);
		// save your data, here just save the current page
		selections2 = getIdSelections2();
		// push or splice the selections if you want to save all data selections
	});
	$table2.on('expand-row.bs.table', function(e, index, row, $detail) {
		if (index % 2 == 1) {
			$detail.html('Loading from ajax request...');
			$.get('LICENSE', function(res) {
				$detail.html(res.replace(/\n/g, '<br>'));
			});
		}
	});
	$table2.on('all.bs.table', function(e, name, args) {
		console.log(name, args);
	});
	$remove2.click(function() {
		var ids = getIdSelections2();
		$table2.bootstrapTable('remove', {
			field : 'id',
			values : ids
		});
		$remove2.prop('disabled', true);
		sumTheAmount();
	});
	$(window).resize(function() {
		$table2.bootstrapTable('resetView', {
			height : getHeight()
		});
	});

 
	//处理Boolean 类型
    function totalIsBooleanFormatter(data){
        return data == 'Y' ? '是' : '否';
    }
    //处理Date 类型
    function totalDateFormatter(date) {
        /*
         * 使用例子:format="yyyy-MM-dd hh:mm:ss";
         */
        var format = new Date(date);
        return format.getFullYear()+"-"+format.getMonth()+"-"+format.getDay()+
            " "+format.getHours()+":"+format.getMinutes()+":"+format.getSeconds();
    }
    function getIdSelections() {
        return $.map($table.bootstrapTable('getSelections'), function (row) {
            return row.id
        });
    }
    
    //responseHandler 处理结果集 在这里处理数据json
    function responseHandler(res) {
        $.each(res.rows, function (i, row) {
            row.state = $.inArray(row.id, selections) !== -1;
        });
        return res;
    }
    
    window.operateEvents = {
        'click .like': function (e, value, row, index) {
            alert('You click like action, row: ' + JSON.stringify(row));
        },
        'click .remove': function (e, value, row, index) {
            $table.bootstrapTable('remove', {
                field: 'id',
                values: [row.id]
            });
        }
    };
    function getHeight() {
        //return $(window).height() - $('h1').outerHeight(true);
        return $('h1').outerHeight(true);
    }

    $(function () {
       /* var scripts = [
                'bootstrap-table/js/bootstrap-table-editable.js'//编辑表格
            ],
            eachSeries = function (arr, iterator, callback) {
                callback = callback || function () {};
                if (!arr.length) {
                    return callback();
                }
                var completed = 0;
                var iterate = function () {
                    iterator(arr[completed], function (err) {
                        if (err) {
                            callback(err);
                            callback = function () {};
                        }
                        else {
                            completed += 1;
                            if (completed >= arr.length) {
                                callback(null);
                            }
                            else {
                                iterate();
                            }
                        }
                    });
                };
                iterate();
            };
            
            eachSeries(scripts, getScript, initTable2);
            eachSeries(scripts, getScript, initTable);*/
    	
    	initTable2();
    	initTable();
    	
    });